<!DOCTYPE html>
<html lang="ms">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Sistem Pengurusan Komputer & Pencetak</title>

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

  <style>
    body { background:#f2f4f7; }
    .container { max-width:720px; }
    .card { border:none; border-radius:14px; box-shadow:0 10px 25px rgba(0,0,0,.08); }
    .hidden { display:none !important; }
    #loading { position:fixed; inset:0; background:rgba(255,255,255,.85); display:none; align-items:center; justify-content:center; flex-direction:column; z-index:9999; }
  </style>
</head>
<body>

<div id="loading">
  <div class="spinner-border text-primary"></div>
  <p class="mt-3">Memprosesâ€¦</p>
</div>

<div class="container py-4">

  <div class="text-center mb-4">
    <img src="Logo_KV.jpg" alt="Gambar Muka Hadapan" class="img-fluid rounded shadow mb-3" style="max-height:160px">
    <h4 class="fw-bold text-center">PEMBANGUNAN SISTEM PENGURUSAN PENGGUNAAN KOMPUTER DAN PENCETAK MENGGUNAKAN KOD QR OLEH PELAJAR ASRAMA DI CYBER CAFE ASRAMA KOLEJ VOKASIONAL PASIR MAS.</h4>
  </div>

  <form id="dataForm" class="card p-4" novalidate>

    <!-- STEP 1 -->
    <div id="step1">
      <h5 class="text-primary mb-3">Maklumat Pengguna</h5>

      <label class="fw-semibold">Kediaman *</label>
      <select id="kediaman" class="form-select mb-3">
        <option value="">-- Pilih --</option>
        <option>Aspura</option>
        <option>Aspuri</option>
      </select>

      <label class="fw-semibold">Nama Penuh *</label>
      <input type="text" id="nama" class="form-control mb-3">

      <label class="fw-semibold">Tahun *</label>
      <select id="tahun" class="form-select mb-3">
        <option value="">-- Pilih --</option>
        <option>DVM</option>
        <option>SVM</option>
      </select>

      <label class="fw-semibold">Kelas *</label>
      <select id="kelas" class="form-select mb-4">
        <option value="">-- Pilih --</option>
        <option>BPP</option>
        <option>BPR</option>
        <option>BKP1</option>
        <option>BKP2</option>
        <option>BPM</option>
        <option>KSK1</option>
        <option>KSK2</option>
      </select>

      <button type="button" class="btn btn-primary w-100" onclick="goStep2()">Seterusnya</button>
    </div>

    <!-- STEP 2 -->
    <div id="step2" class="hidden">
      <h5 class="text-primary mb-3">Tujuan Penggunaan</h5>

      <select id="tujuan" class="form-select mb-3">
        <option value="">-- Pilih --</option>
        <option value="Print">Print</option>
        <option value="Komputer">Penggunaan Komputer</option>
        <option value="Lain">Lain-lain</option>
      </select>

      <input type="text" id="lain" class="form-control mb-3 hidden" placeholder="Nyatakan tujuan">

      <div class="d-flex justify-content-between">
        <button type="button" class="btn btn-outline-secondary" onclick="showStep(1)">Kembali</button>
        <button type="button" class="btn btn-primary" onclick="goStep3()">Seterusnya</button>
      </div>
    </div>

    <!-- STEP 3 (hanya untuk Print) -->
    <div id="step3" class="hidden">
      <h5 class="text-primary mb-3">Pembayaran</h5>

      <select id="bayaran" class="form-select mb-3">
        <option value="">-- Pilih --</option>
        <option>Tunai</option>
        <option>QR</option>
      </select>

      <div id="qr" class="border rounded p-3 bg-warning-subtle hidden text-center">
        <p class="fw-semibold">Imbas Kod QR</p>
        <img src="QR_CikguRuslina.jpeg" alt="Kod QR Pembayaran" class="img-fluid rounded" style="max-height:200px">
        <small class="text-muted d-block mt-2">Sila imbas QR untuk membuat pembayaran</small>
      </div>

      <div class="d-flex justify-content-between">
        <button type="button" class="btn btn-outline-secondary" onclick="showStep(2)">Kembali</button>
        <button type="button" class="btn btn-success" onclick="submitData()">Hantar</button>
      </div>
    </div>

    <!-- SUCCESS -->
    <div id="success" class="hidden text-center">
      <h3 class="text-success fw-bold">ðŸŽ‰ Tahniah!</h3>
      <p class="lead">Maklumat anda telah <strong>berjaya</strong> direkodkan.</p>

      <div class="d-grid gap-2 mt-4">
        <button type="button" class="btn btn-primary" onclick="resetForm()">Isi Semula</button>
      </div>
    </div>

  </form>
</div>

<script>
const loading = document.getElementById('loading');
const GAS_URL = "https://script.google.com/macros/s/AKfycbxneelC9-N7p7Nuv9RA6Yl3sBTCwbxxxPDKuKA3hZnvUyy_iv9eLHfTE6syla_NuD0q/exec";

function showStep(n){
  ['step1','step2','step3','success'].forEach(id=>document.getElementById(id).classList.add('hidden'));
  document.getElementById('step'+n).classList.remove('hidden');
}

function goStep2(){
  if(!kediaman.value || !nama.value || !tahun.value || !kelas.value){
    alert('Sila lengkapkan semua maklumat');
    return;
  }
  showStep(2);
}

function goStep3(){
  if(!tujuan.value){
    alert('Sila pilih tujuan');
    return;
  }
  if(tujuan.value === 'Print'){
    showStep(3);
  } else {
    submitData(); // Komputer & Lain-lain terus berjaya
  }
}

tujuan.addEventListener('change',()=>{
  lain.classList.toggle('hidden', tujuan.value !== 'Lain');
});

bayaran.addEventListener('change',()=>{
  qr.classList.toggle('hidden', bayaran.value !== 'QR');
});

function submitData(){
  loading.style.display='flex';

  const data = {
    kediaman: kediaman.value,
    nama: nama.value,
    tahun: tahun.value,
    kelas: kelas.value,
    tujuan: tujuan.value === 'Lain' ? lain.value : tujuan.value,
    bayaran: bayaran.value || (tujuan.value==="Print" ? '' : 'Tiada')
  };

  // Hantar data ke Google Sheet
  fetch(GAS_URL, {
    method:'POST',
    body: new URLSearchParams(data)
  })
  .then(response => response.json())
  .then(result => {
    loading.style.display='none';
    if(result.result === "success"){
      ['step1','step2','step3'].forEach(id=>document.getElementById(id).classList.add('hidden'));
      document.getElementById('success').classList.remove('hidden');
    } else {
      alert("Ralat: "+result.message);
    }
  })
  .catch(err=>{
    loading.style.display='none';
    alert("Ralat sambungan, sila cuba lagi");
    console.error(err);
  });
}

function resetForm(){
  document.getElementById('dataForm').reset();
  showStep(1);
}
</script>

</body>
</html>
